#include <CAN.h>

// Dummy function to simulate reading a temperature sensor
byte readTemperature() {
  // Replace this with actual temperature reading code
  return random(0, 100); // Random temperature value between 0-99
}

void setup() {
  Serial.begin(115200);
  // Initialize CAN at 500 kbps
  if (!CAN.begin(500E3)) {
    Serial.println("Starting CAN failed!");
    while (1);
  }
  Serial.println("CAN started on Board 1.");
}

void loop() {
  // Create a CAN message
  CAN.beginPacket(0x01); // CAN ID for Board 1
  CAN.write(readTemperature()); // Read and write temperature to byte 1
  CAN.write(0x00);              // Placeholder for byte 2
  CAN.write(0x00);              // Placeholder for byte 3
  CAN.write(0x00);              // Placeholder for byte 4
  CAN.write(0x00);              // Placeholder for byte 5
  CAN.write(0x00);              // Placeholder for byte 6
  CAN.write(0x00);              // Placeholder for byte 7
  CAN.write(0x00);              // Placeholder for byte 8
  CAN.endPacket();              // Send the packet

  Serial.println("Temperature value sent from Board 1.");
  delay(1000);                  // Wait before sending the next message
}




#include <CAN.h>

// Dummy function to simulate reading voltage from a potentiometer
byte readVoltage() {
  // Replace this with actual potentiometer reading code
  return random(0, 255); // Random voltage value between 0-255
}

void setup() {
  Serial.begin(115200);
  // Initialize CAN at 500 kbps
  if (!CAN.begin(500E3)) {
    Serial.println("Starting CAN failed!");
    while (1);
  }
  Serial.println("CAN started on Board 2.");
}

void loop() {
  // Check if data is available
  if (CAN.parsePacket()) {
    Serial.println("Message received on Board 2.");

    // Create an array to store the bytes
    byte message[8];
    for (int i = 0; i < 8; i++) {
      message[i] = CAN.read(); // Read all bytes
    }

    // Print received bytes
    Serial.print("Byte 1 (Temperature): ");
    Serial.println(message[0]);
    
    // Read and write voltage to byte 2
    message[1] = readVoltage(); 

    // Forward the message with updated byte 2
    CAN.beginPacket(0x01); // Forward to the same CAN ID
    for (int i = 0; i < 8; i++) {
      CAN.write(message[i]); // Write all bytes to forward
    }
    CAN.endPacket();

    Serial.println("Voltage value sent from Board 2.");
  }
}



